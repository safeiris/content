# –Ø–¥—Ä–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ‚Äî –≠—Ç–∞–ø 1 (–¥–µ–º–æ –±–µ–∑ UI)

## –ß—Ç–æ —ç—Ç–æ
–ë–∞–∑–æ–≤—ã–π –º–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Ç–µ–º–∞, —Ü–µ–ª—å, –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, —Ç–æ–Ω, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –æ–±—ä—ë–º)
–∏ —Å–æ–±–∏—Ä–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –º–æ–¥–µ–ª–∏.

## –§–∞–π–ª—ã
- `config.py` ‚Äî –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
- `helpers.py` ‚Äî —É—Ç–∏–ª–∏—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
- `rules_engine.py` ‚Äî —Å–±–æ—Ä–∫–∞ –ø—Ä–æ–º–ø—Ç–∞ (`build_prompt(data)`).
- `base_prompt.txt` ‚Äî —à–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞.
- `input_example.json` ‚Äî –ø—Ä–∏–º–µ—Ä –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
- `run_demo.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ UI.
- `docs/implementation_overview.md` ‚Äî —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å –æ–±–∑–æ—Ä–æ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
```bash
python3 -m venv venv
# macOS/Linux:
source venv/bin/activate
# Windows (PowerShell):
# venv\Scripts\activate

python run_demo.py

```

## –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ API –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

```bash
# UI –∏ API –≤ –æ–¥–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ (Flask —Å–µ—Ä–≤–∏—Ç —Ñ—Ä–æ–Ω—Ç –∏ REST API)
python -m server

# –¢–æ–ª—å–∫–æ API (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–µ–∑ UI)
make api

# Flask-—Å–µ—Ä–≤–µ—Ä –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
make dev
```

### –ë—ã—Å—Ç—Ä—ã–π smoke-—Ç–µ—Å—Ç API

```bash
make health                 # /api/health
make reindex SMOKE_THEME=finance   # /api/reindex (—Ç–µ–º–∞—Ç–∏–∫–∞ –∑–∞–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ SMOKE_THEME)
make generate-dry SMOKE_THEME=finance  # /api/generate –≤ dry-run —Ä–µ–∂–∏–º–µ
```

> –í `generate-dry` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –º–æ–¥–µ–ª—å ‚Äî –∏–º —É–¥–æ–±–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥/–±—ç–∫–µ–Ω–¥ —Å–≤—è–∑–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

## RAG-ready (Stage 1)

### Profiles layout
- `profiles/<theme>/exemplars/` ‚Äî —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –ø–æ 200‚Äì700 —Å–ª–æ–≤ (–æ–¥–Ω–æ –∫–ª—é—á–µ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Ñ–∞–π–ª, –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π Markdown). –ü—Ä–∏–º–µ—Ä: `profiles/finance/exemplars/{001_intro.md, 002_benefits.md, 003_faq.md}`.
- `profiles/<theme>/glossary.txt` ‚Äî –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π.
- `profiles/<theme>/style_guide.md` ‚Äî —Ç–æ–Ω, do/don't, –ø–æ–ª–∏—Ç–∏–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏.

### –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –±–µ–∑ LLM
- `assemble_messages.py` ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç `CONTEXT`, –∫–æ–≥–¥–∞ `retrieve_exemplars()` –Ω–∞—á–Ω—ë—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã.
- `retrieve_exemplars(theme_slug, query, k=3)` ‚Äî –∫–æ–Ω—Ç—Ä–∞–∫—Ç Stage 2: –¥–æ–ª–∂–µ–Ω –æ—Ç–¥–∞–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π –≤–∏–¥–∞ `{ "path": str, "text": str, "score": float }`, –ø–æ–¥–æ–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–¥ —Ç–æ–∫–µ–Ω-–±—é–¥–∂–µ—Ç (~500‚Äì700 —Ç–æ–∫–µ–Ω–æ–≤ —Å—É–º–º–∞—Ä–Ω–æ).
- –ò—Ç–æ–≥–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π: `[{"role": "system", ...}, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π CONTEXT, {"role": "user", "content": "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π —Ç–µ–∫—Å—Ç –ø–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º."}]`.

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Stage 1
- `python run_demo.py` ‚Äî –±–∞–∑–æ–≤—ã–π –ø–æ—Ç–æ–∫ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π).
- `python validate_prompt.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å–µ–∫—Ü–∏–π –∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –≤ –ø—Ä–æ–º–ø—Ç–µ.
- `python assemble_messages.py` ‚Äî –ø–µ—á–∞—Ç–∞–µ—Ç –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä system –∏ CONTEXT (–ø–æ–∫–∞ –ø—É—Å—Ç–æ).
- `python prompt_to_file.py` ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–º–ø—Ç –≤ `./artifacts/prompt_<timestamp>.txt`.

### –°–∫–≤–æ–∑–Ω–æ–π –ø—Ä–æ–≥–æ–Ω —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å—Ç–∞—Ç—å–∏
1. –°–æ–±–µ—Ä–∏ –∏–Ω–¥–µ–∫—Å (–æ–¥–∏–Ω —Ä–∞–∑ –∏–ª–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–ª–∏–ø–æ–≤): `python -m retrieval index --theme finance`
2. –ó–∞–ø—É—Å—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é: `python orchestrate.py --theme finance --data input_example.json --k 3`
3. –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–º–æ—Ç—Ä–∏ –≤ `artifacts/*.md` –∏ —Å–æ—Å–µ–¥–Ω–µ–º `.json` —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏.

#### –ü—Ä–∏–º–µ—Ä –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

–°–æ–∑–¥–∞–π—Ç–µ `batch.json` —Å –º–∞—Å—Å–∏–≤–æ–º –∑–∞–¥–∞–Ω–∏–π (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å YAML —Å —Ç–µ–º–∏ –∂–µ –ø–æ–ª—è–º–∏):

```json
[
  {
    "theme": "finance",
    "data": "input_example.json",
    "k": 0,
    "outfile": "artifacts/finance_draft.md"
  },
  {
    "theme": "finance",
    "data": "input_example.json",
    "k": 3,
    "outfile": "artifacts/finance_context.md"
  },
  {
    "theme": "mortgage",
    "data": "mock_data/mortgage.json",
    "k": 2,
    "outfile": "artifacts/mortgage.md"
  }
]
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –æ–¥–Ω–∏–º –≤—ã–∑–æ–≤–æ–º:

```bash
python orchestrate.py --batch batch.json --mode draft
```

–ö–∞–∂–¥–æ–µ –∑–∞–¥–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç —Å—Ç–∞—Ç—å—é –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π `outfile` –∏ —Å–æ—Å–µ–¥–Ω–∏–π `.json`.

#### A/B —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –±–µ–∑ –∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

–ß—Ç–æ–±—ã —Å—Ä–∞–≤–Ω–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –±–µ–∑ CONTEXT –∏ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º `k`, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∂–∏–º `--ab compare`:

```bash
python orchestrate.py --theme finance --data input_example.json --k 3 --ab compare
```

–í –∫–∞—Ç–∞–ª–æ–≥–µ `artifacts/` –ø–æ—è–≤—è—Ç—Å—è —Ñ–∞–π–ª—ã —Å —Å—É—Ñ—Ñ–∏–∫—Å–∞–º–∏ `__A` (–±–µ–∑ CONTEXT) –∏ `__B` (—Å CONTEXT),
–∞ —Ä—è–¥–æ–º —Å –∫–∞–∂–¥—ã–º ‚Äî `.json` —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏. –ö–æ–º–∞–Ω–¥–∞ –≤—ã–≤–æ–¥–∏—Ç –¥–ª–∏–Ω—ã –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–±–æ–∏—Ö –ø—Ä–æ–≥–æ–Ω–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.

### Ready for Stage 2, –∫–æ–≥–¥–∞
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π —Å–æ–∑–¥–∞–Ω–∞ –º–∏–Ω–∏–º—É–º –¥–ª—è –æ–¥–Ω–æ–π —Ç–µ–º—ã —Å 2‚Äì3 –∑–∞–≥–æ—Ç–æ–≤–∫–∞–º–∏.
- `base_prompt.txt` –∑–Ω–∞–µ—Ç –ø—Ä–æ –±–ª–æ–∫ CONTEXT.
- –°—É—â–µ—Å—Ç–≤—É—é—Ç —Å—Ç–∞–±—ã `retrieve_exemplars` –∏ `assemble_messages` –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
- –í –ø—Ä–æ–µ–∫—Ç –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ —Å–µ—Ç–µ–≤—ã–µ –≤—ã–∑–æ–≤—ã.

## üí¨ –°—Ç–∏–ª–µ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏

–í —Ñ–∞–±—Ä–∏–∫–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å—Ç–∏–ª–µ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ–º–∞—Ç–∏–∫. –î–ª—è —Ç–µ–º—ã Finance –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
—ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π —Å—Ç–∏–ª—å, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ –ø–æ—Ä—Ç–∞–ª–∞ Sravni.ru. –û—Ç–∫–ª—é—á–∏—Ç—å –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `style_profile=off` –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
–æ–∫—Ä—É–∂–µ–Ω–∏—è.

## Troubleshooting

- **OpenAI key** ‚Äî —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `OPENAI_API_KEY` –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º `python -m server`. UI –ø–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç—É—Å ¬´OpenAI key –Ω–µ –Ω–∞–π–¥–µ–Ω¬ª, –µ—Å–ª–∏ –∫–ª—é—á –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
- **–ò–Ω–¥–µ–∫—Å** ‚Äî –µ—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∞ Health –≥–æ–≤–æ—Ä–∏—Ç `index missing`, —Å–æ–±–µ—Ä–∏—Ç–µ –∏–Ω–¥–µ–∫—Å: `python -m retrieval index --theme <slug>`. –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–Ω–æ–ø–∫–æ–π ¬´Health check¬ª.
- **–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã** ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `artifacts/` –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –∏ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ–π –Ω–∞ –∑–∞–ø–∏—Å—å. –°–æ–∑–¥–∞–π—Ç–µ –µ—ë –≤—Ä—É—á–Ω—É—é (`mkdir -p artifacts`), –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤–ø–µ—Ä–≤—ã–µ.
- **CORS / —É–¥–∞–ª—ë–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø** ‚Äî —Å–µ—Ä–≤–µ—Ä —É–∂–µ –æ—Ç–¥–∞—ë—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ CORS –¥–ª—è `/api/*`. –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –Ω–∞ –¥—Ä—É–≥–æ–º —Ö–æ—Å—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `python -m server --host 0.0.0.0 --port 8000` –∏ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ UI –ø–æ `http://<host>:<port>`.

