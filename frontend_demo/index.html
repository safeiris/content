<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Фабрика контента — демо</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="app-header">
      <div class="app-shell header-inner">
        <div>
          <h1>Фабрика контента</h1>
          <p class="subtitle">Платформа генерации текстов на базе AI</p>
        </div>
      </div>
    </header>

    <main class="app app-shell">
      <nav class="tabs" role="tablist">
        <button class="tab active" data-tab="new-request" role="tab">Новый запрос</button>
        <button class="tab" data-tab="materials" role="tab">Сгенерированные материалы</button>
        <button class="tab" data-tab="pipes" role="tab">Тематики</button>
        <button class="tab" data-tab="result" role="tab">Результат</button>
      </nav>

      <section class="tab-panel active" id="new-request" role="tabpanel">
        <div class="request-shell">
          <div class="request-grid">
            <form id="brief-form" class="brief-form">
              <section class="parameters-card">
                <header class="parameters-card__header">
                  <h2 class="parameters-card__title">Параметры текста</h2>
                </header>
                <div class="parameters-card__body">
                  <div class="form-row">
                    <label for="pipe-select">Тематика</label>
                    <select id="pipe-select" required></select>
                  </div>
                  <div class="form-row">
                    <label for="title-input">Название</label>
                    <input id="title-input" type="text" placeholder="Например, «Гид по дебетовым картам 2024»" />
                    <p class="field-hint">Оставьте пустым, чтобы взять название из профиля.</p>
                  </div>
                  <div class="form-row">
                    <label for="goal-input">Цель</label>
                    <textarea id="goal-input" rows="2" placeholder="Например, объяснить преимущества продукта и увеличить заявки"></textarea>
                  </div>
                  <div class="form-row">
                    <label for="audience-input">Аудитория</label>
                    <textarea id="audience-input" rows="2" placeholder="Например, пользователи, выбирающие первую дебетовую карту"></textarea>
                  </div>
                  <div class="form-row">
                    <label for="tone-select">Тон</label>
                    <select id="tone-select">
                      <option value="экспертный" selected>Экспертный</option>
                      <option value="дружелюбный">Дружелюбный</option>
                      <option value="строгий">Строгий</option>
                    </select>
                  </div>
                  <div class="form-row">
                    <label for="style-profile-select">Стиль бренда</label>
                    <select id="style-profile-select">
                      <option value="sravni.ru" selected>sravni.ru — экспертно, структурировано</option>
                      <option value="tinkoff.ru">tinkoff.ru — дружелюбно и с примерами</option>
                      <option value="banki.ru">banki.ru — аналитично и по делу</option>
                      <option value="off">Без привязки к бренду</option>
                    </select>
                    <p class="field-hint" id="style-profile-hint">
                      Определяет тон и подачу текста, близкие к стилю выбранного бренда.
                    </p>
                  </div>
                  <div class="form-row">
                    <label for="min-chars-input">Объём текста</label>
                    <div class="length-range-inline">
                      <input
                        id="min-chars-input"
                        type="number"
                        min="500"
                        step="50"
                        value="3500"
                        aria-label="Минимум символов"
                      />
                      <span aria-hidden="true" class="range-separator">—</span>
                      <input
                        id="max-chars-input"
                        type="number"
                        min="500"
                        step="50"
                        value="6000"
                        aria-label="Максимум символов"
                      />
                    </div>
                    <p class="field-hint">Символов без пробелов. Можно изменить диапазон под задачу.</p>
                  </div>
                  <div class="form-row">
                    <label for="structure-preset">Пресет структуры</label>
                    <select id="structure-preset">
                      <option value="seo" selected>SEO-статья</option>
                      <option value="faq">FAQ и поддержка</option>
                      <option value="overview">Обзор продукта</option>
                    </select>
                    <p class="field-hint">Выберите заготовку или отредактируйте структуру вручную ниже.</p>
                  </div>
                  <div class="form-row">
                    <label for="structure-input">Структура материала</label>
                    <textarea
                      id="structure-input"
                      rows="4"
                      placeholder="Каждый пункт с новой строки: вводная, блок преимуществ, FAQ, заключение"
                    ></textarea>
                  </div>
                  <div class="form-row">
                    <label for="keywords-input">Ключевые слова</label>
                    <textarea
                      id="keywords-input"
                      rows="4"
                      placeholder="Каждое ключевое слово или фраза с новой строки"
                    ></textarea>
                    <div class="keyword-mode">
                      <span class="field-label">Режим вхождений</span>
                      <div class="keyword-mode__options">
                        <label class="radio-option">
                          <input type="radio" name="keywords-mode" value="strict" checked />
                          <span>Строгое — точные вхождения</span>
                        </label>
                        <label class="radio-option">
                          <input type="radio" name="keywords-mode" value="soft" />
                          <span>Мягкое — допускает формы и синонимы</span>
                        </label>
                        <label class="radio-option">
                          <input type="radio" name="keywords-mode" value="anti_spam" />
                          <span>Антипереспам — следим за частотой</span>
                        </label>
                      </div>
                    </div>
                    <p class="field-hint">Можно оставить пустым — ключевые слова не будут добавлены.</p>
                  </div>
                  <div class="form-row">
                    <label>Источники (референсы)</label>
                    <div id="sources-list" class="sources-list"></div>
                    <div class="sources-actions">
                      <button type="button" class="ghost small" id="add-source-btn">Добавить источник</button>
                    </div>
                    <p class="field-hint">Добавьте ссылки и тип использования, если нужно опираться на конкретные материалы.</p>
                  </div>
                  <div class="form-row">
                    <label for="context-source-select">Контекст</label>
                    <select id="context-source-select">
                      <option value="index.json" selected>Профиль темы (index.json)</option>
                      <option value="custom">Свой текст</option>
                      <option value="off">Без контекста</option>
                    </select>
                    <p id="context-source-help" class="field-hint">
                      Определяет, откуда система возьмёт дополнительные сведения для промпта.
                    </p>
                    <div class="custom-context-block" id="custom-context-block" hidden>
                      <p class="field-hint custom-context-hint">
                        Можно вставить текст или загрузить .txt/.json. До 20 000 символов.
                      </p>
                      <label class="field-label" for="customContext">Пользовательский контекст</label>
                      <textarea id="customContext" placeholder="Вставьте сюда текст или JSON"></textarea>
                      <div class="custom-context-meta">
                        <span class="custom-context-counter" id="customContextCounter">0 / 20 000 символов</span>
                        <div class="custom-context-file">
                          <input type="file" id="customContextFile" accept=".txt,.json" />
                          <button type="button" class="ghost small" id="customContextClear">Очистить</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="form-actions">
                  <button type="submit" class="primary">
                    <span class="btn-label">Сгенерировать</span>
                  </button>
                </div>
              </section>
            </form>
            <aside class="status-panel">
              <section class="status-card">
                <h3>Health</h3>
                <div id="health-status" class="status-grid"></div>
              </section>
              <section class="status-card">
                <div class="section-header">
                  <h3>Reindex log</h3>
                  <button type="button" class="ghost small" id="clear-log">Очистить</button>
                </div>
                <div id="reindex-log" class="console-log">
                  <div class="log-empty">Пока без запусков.</div>
                </div>
              </section>
            </aside>
          </div>
        </div>
      </section>
      <section class="tab-panel" id="materials" role="tabpanel">
        <div class="materials-toolbar">
          <div class="materials-toolbar__spacer"></div>
          <button type="button" class="ghost small" id="cleanup-artifacts">Очистить список</button>
        </div>
        <div id="artifacts-list" class="cards-grid"></div>
      </section>

      <section class="tab-panel" id="pipes" role="tabpanel">
        <div id="pipes-list" class="pipes-grid"></div>
      </section>

      <section class="tab-panel" id="result" role="tabpanel">
        <div class="result-layout">
          <div class="result-main">
            <div class="result-header">
              <h2 id="result-title">Результат генерации</h2>
              <div class="result-meta">
                <p id="result-meta"></p>
                <div class="badges" id="result-badges"></div>
                <button type="button" class="secondary" id="retry-btn" hidden>Повторить</button>
              </div>
            </div>
            <section class="used-keywords" id="used-keywords" hidden>
              <h3>Использованные ключи</h3>
              <ul id="used-keywords-list" class="used-keywords__list"></ul>
              <p id="used-keywords-empty" class="used-keywords__empty" hidden>
                Ключевые слова не использовались.
              </p>
            </section>
            <section class="prompt-preview" id="prompt-preview">
              <h3>Предпросмотр промпта</h3>
              <div class="prompt-grid">
                <article>
                  <header>SYSTEM</header>
                  <pre id="preview-system" class="prompt-text">Нажмите «Сгенерировать», чтобы увидеть контент.</pre>
                </article>
                <article>
                  <header>
                    CONTEXT <span id="context-badge" class="badge neutral">не запрошен</span>
                  </header>
                  <ul id="context-list" class="context-list"></ul>
                  <p id="context-summary" class="context-summary"></p>
                </article>
                <article>
                  <header>USER</header>
                  <pre id="preview-user" class="prompt-text"></pre>
                </article>
              </div>
            </section>
            <article id="draft-view" class="draft-view"></article>
          </div>
          <aside class="result-aside">
            <h3>Отчет о качестве</h3>
            <div id="report-view" class="report-view"></div>
            <div class="download-buttons">
              <a
                id="download-md"
                class="secondary"
                role="button"
                aria-disabled="true"
                data-fallback-name="draft.md"
              >
                <span class="btn-label">Скачать .md</span>
              </a>
              <a
                id="download-report"
                class="secondary"
                role="button"
                aria-disabled="true"
                data-fallback-name="report.json"
              >
                <span class="btn-label">Скачать отчёт .json</span>
              </a>
            </div>
          </aside>
        </div>
      </section>
    </main>

    <div id="progress-overlay" class="progress-overlay hidden" role="alert" aria-live="polite">
      <div class="progress-card">
        <p class="progress-stage" data-role="progress-stage">Шаг: Черновик 0→100%</p>
        <p class="progress-status-badge hidden" data-role="progress-badge">
          Получен неполный ответ, пробуем догенерировать
        </p>
        <div
          class="progress-bar"
          role="progressbar"
          aria-valuemin="0"
          aria-valuemax="100"
          aria-valuenow="0"
          data-role="progress-bar"
        >
          <div class="progress-bar__fill" data-role="progress-bar-fill"></div>
        </div>
        <p class="progress-percent" data-role="progress-percent">0%</p>
        <p class="progress-message" data-role="progress-message">Готовим данные…</p>
        <p class="progress-details" data-role="progress-details"></p>
      </div>
    </div>

    <template id="source-row-template">
      <div class="source-row">
        <input class="source-input" type="text" placeholder="https://example.com" />
        <select class="source-usage" aria-label="Тип использования источника">
          <option value="summary" selected>Пересказ</option>
          <option value="quote">Цитата</option>
          <option value="inspiration">Вдохновение</option>
        </select>
        <button type="button" class="icon-button remove-source" aria-label="Удалить источник">✕</button>
      </div>
    </template>

    <template id="artifact-card-template">
      <article class="card">
        <div class="card-header">
          <h3 class="card-title"></h3>
          <span class="status"></span>
        </div>
        <p class="card-topic"></p>
        <p class="card-meta"></p>
        <div class="card-actions">
          <button type="button" class="secondary subtle open-btn">
            <span class="btn-label">Открыть</span>
          </button>
          <button type="button" class="secondary subtle download-btn">
            <span class="btn-label">Скачать</span>
          </button>
          <button type="button" class="secondary danger delete-btn">
            <span class="btn-label">Удалить</span>
          </button>
        </div>
      </article>
    </template>

    <div id="toast-root" class="toast-root" aria-live="polite" aria-atomic="true"></div>

    <script src="script.js" type="module"></script>
  </body>
</html>
